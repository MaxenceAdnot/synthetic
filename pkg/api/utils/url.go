package utils

import (
	"net/url"
	"regexp"
	"strings"
	"unicode/utf8"
)

func IsURL(rawURL string) bool {
	var (
		maxURLRuneCount = 2083
		minURLRuneCount = 3

		IP           = `(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))`
		URLSchema    = `((https?):\/\/)`
		URLUsername  = `(\S+(:\S*)?@)`
		URLPath      = `((\/|\?|#)[^\s]*)`
		URLPort      = `(:(\d{1,5}))`
		URLIP        = `([1-9]\d?|1\d\d|2[01]\d|22[0-3]|24\d|25[0-5])(\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])){2}(?:\.([0-9]\d?|1\d\d|2[0-4]\d|25[0-5]))`
		URLSubdomain = `((www\.)|([a-zA-Z0-9]+([-_\.]?[a-zA-Z0-9])*[a-zA-Z0-9]\.[a-zA-Z0-9]+))`
		URL          = `^` + URLSchema + URLUsername + `?` + `((` + URLIP + `|(\[` + IP + `\])|(([a-zA-Z0-9]([a-zA-Z0-9-_]+)?[a-zA-Z0-9]([-\.][a-zA-Z0-9]+)*)|(` + URLSubdomain + `?))?(([a-zA-Z\x{00a1}-\x{ffff}0-9]+-?-?)*[a-zA-Z\x{00a1}-\x{ffff}0-9]+)(?:\.([a-zA-Z\x{00a1}-\x{ffff}]{1,}))?))\.?` + URLPort + `?` + URLPath + `?$`
		rxURL        = regexp.MustCompile(URL)
	)

	if rawURL == "" || utf8.RuneCountInString(rawURL) >= maxURLRuneCount || len(rawURL) <= minURLRuneCount || strings.HasPrefix(rawURL, ".") {
		return false
	}

	strTemp := rawURL

	url, err := url.Parse(strTemp)
	if err != nil {
		return false
	}

	if strings.HasPrefix(url.Host, ".") {
		return false
	}

	if url.Host == "" && (url.Path != "" && !strings.Contains(url.Path, ".")) {
		return false
	}

	return rxURL.MatchString(rawURL)
}

func IsHTTPMethod(method string) bool {
	switch method {
	case "GET", "POST", "PUT", "DELETE", "PATCH", "HEAD", "OPTIONS":
		return true
	default:
		return false
	}
}

func IsHTTPStatusCode(statusCode int) bool {
	if statusCode >= 100 && statusCode <= 599 {
		return true
	}

	return false
}
